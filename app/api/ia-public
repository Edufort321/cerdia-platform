// app/api/ia-public/route.ts
import { OpenAIStream, StreamingTextResponse } from 'ai'
import OpenAI from 'openai'

// Créer une instance OpenAI
const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY, // Assure-toi que cette variable est dans ton .env
})

export const runtime = 'edge'

export async function POST(req: Request) {
  const { prompt } = await req.json()

  // Prompt de contrôle pour restreindre l’IA
  const fullPrompt = `Tu es l'assistant officiel de la plateforme Investissement CERDIA. Tu réponds uniquement aux questions sur la vision de CERDIA, l'investissement immobilier, l'IA stratégique et les services offerts. Tu es professionnel, clair, courtois, mais jamais généraliste. Voici la question : ${prompt}`

  const response = await openai.chat.completions.create({
    model: 'gpt-4',
    stream: true,
    messages: [
      {
        role: 'system',
        content:
          "Tu es une IA spécialisée de CERDIA. Tu réponds comme un assistant de la firme à propos de ses services, sa mission, sa vision, et son modèle. Tu n'inventes rien en dehors de ton champ.",
      },
      {
        role: 'user',
        content: fullPrompt,
      },
    ],
  })

  const stream = OpenAIStream(response)
  return new StreamingTextResponse(stream)
}
